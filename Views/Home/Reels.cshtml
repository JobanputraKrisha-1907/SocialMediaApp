
@{
    Layout = null;
}

<!--<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Reels</title>

</head>
<body>-->

    @*<div>
            <div class="embedsocial-hashtag" data-ref="89b465c0def5a6ecc55863fc8837829be8b04d5a"> <a class="feed-powered-by-es feed-powered-by-es-feed-img" href="https://embedsocial.com/" target="_blank" title="Widget by EmbedSocial"> <img src="https://embedsocial.com/cdn/images/embedsocial-icon.png" alt="EmbedSocial"> Widget by EmbedSocial </a> </div>
            <script>(function (d, s, id) { var js; if (d.getElementById(id)) { return; } js = d.createElement(s); js.id = id; js.src = "https://embedsocial.com/cdn/ht.js"; d.getElementsByTagName("head")[0].appendChild(js); }(document, "script", "EmbedSocialHashtagScript"));</script>
        </div>*@
    <!--<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="~/Script/Script.js"></script>
</body>
</html>-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Reels Feature</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .sub-section {
            margin: 20px;
        }

            .sub-section a {
                text-decoration: none;
                color: black;
                font-size: 20px;
            }

        .popup {
            /*position: fixed;
            top: 0;
            left: 0;*/
            width: 100%;
            height: 100%;
           /* background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;*/
        }

        .popup-content {
            background: skyblue;
            padding: 20px;
            border-radius: 5px;
            width: 600px;
            max-width: 100%;
           margin:auto;
        }

        .close {
            cursor: pointer;
            font-size: 20px;
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .popup-header h1 {
            margin: 0;
        }

        .popup-body {
            display: flex;
            align-items: flex-start;
        }

        .popup-left, .popup-right {
            width: 50%;
            padding: 10px;
        }

        .vertical-line {
            border-left: 1px solid #ccc;
            height: 100%;
        }

        #selectedVideoPreview video {
            max-width: 100%;
            max-height: 200px;
            display: block;
            margin-top: 10px;
        }
        * {
            margin: 0;
            padding: 0;
        }

        body, button {
            font-family: "Segoe UI", sans-serif;
            color: #FFFFFF;
        }

        body {
            font-size: 12px;
        }

        section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
           /* background-color: #1A1A1A;*/
        }

        button {
            background: black;
            border: 1px solid white;
            font-weight: 600;
            padding: 0.15rem 0.3rem;
            border-radius: 3px;
            font-size: 12px;
        }

        /*.reel__container {
            height: 629.76px;
            width: 354.24px;
            background: url(https://i.imgur.com/jg6HwrR.gif) no-repeat center;
            background-size: cover;
            border-radius: 10px;
            padding: 1rem;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
        }*/
        .reel__container {
            position: relative; /* Required for absolute positioning of video */
            height: 629.76px;
            width: 354.24px;
            border-radius: 10px;
            padding: 1rem;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
            overflow: hidden; /* Ensure video doesn't overflow */
        }

        .reel__background-video {
            position: absolute; /* Position the video behind other content */
            top: 0;
            left: 0;
            width: 100%; /* Spread the video horizontally to cover the container */
            height: 100%; /* Spread the video vertically to cover the container */
            object-fit: cover; /* Maintain aspect ratio and cover the entire container */
            z-index: -1; /* Ensure video is behind other content */
            border-radius: inherit; /* Apply the same border radius as the container */
        }


        .reel__title {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .reel__back-button {
            display: flex;
            align-items: center;
        }

            .reel__back-button p {
                font-weight: 700;
                font-size: 16px;
            }

        .icon-tabler-arrow-narrow-left {
            margin-right: 0.5rem
        }

        .reel__content {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
        }

        .reel__user {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .reel__avatar {
            width: 30px;
            height: 30px;
            object-fit: cover;
            border-radius: 30px;
            margin-right: 0.5rem;
        }

        .reel__username {
            font-weight: 600;
            margin-right: 0.5rem;
        }

        .icon-tabler-message-circle {
            transform: scaleX(-1);
        }

        .reel__options {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height:55px;
            align-items: center;
        }

        .reel__audio-cover {
            width: 24px;
            height: 24px;
            object-fit: cover;
            border: 3px solid #FFFFFF;
            border-radius: 7px;
        }

        .reel__likes {
            font-weight: 600;
            margin-top: -1rem;
            font-size: 11px;
        }

        .reel__caption {
            margin-bottom: 0.5rem;
        }

        .reel__audio {
            display: flex;
            align-items: center;
            margin-left: -0.4rem;
        }

    </style>
</head>
<body>

    @*<div class="sub-section" id="hidden1">
        <i class="fa-solid fa-square-plus"></i>
        <a href="#" id="postReelLink">Post Reels</a>
    </div>*@

    <div id="postReelPopup" class="popup" style="display:block">
        <div class="popup-content p-3">
            <span class="close" id="closePopup">X</span>
            <div class="popup-header">
                <h1 class="mb-4">Post Reel</h1>
            </div>
            <div class="popup-body">
                <div class="popup-left">
                    <input type="file" id="reelVideoInput" class="form-control-file mb-3" accept="video/*">
                    <br><br>
                    <textarea id="captionInput" class="form-control mb-3" placeholder="Write a caption..." rows="3"></textarea><br>
                    <button class="btn btn-primary" id="shareButton">Share</button>
                </div>
                <div class="vertical-line"></div>
                <div class="popup-right">
                    <div id="selectedVideoPreview"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="reelsContainer" style="margin-top:140px">
      
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#postReelLink').on('click', function (event) {
                event.preventDefault();
                $('#postReelPopup').fadeIn();
            });

            $('#closePopup').on('click', function () {
                $('#postReelPopup').fadeOut();
            });

            $('#reelVideoInput').on('change', function () {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        $('#selectedVideoPreview').html(`<video controls src="${e.target.result}" alt="Selected Video"></video>`);
                    }
                    reader.readAsDataURL(file);
                }
            });

            $(window).on('click', function (event) {
                if ($(event.target).is('#postReelPopup')) {
                    $('#postReelPopup').fadeOut();
                }
            });

            $('#shareButton').on('click', function (event) {
                event.preventDefault();

                const formData = new FormData();
                const videoFile = $('#reelVideoInput')[0].files[0];
                const userId = localStorage.getItem('UserId');
                const caption = $('#captionInput').val();

                if (!videoFile) {
                    alert('Please select a video to upload.');
                    return;
                }

                formData.append('video', videoFile);
                formData.append('userId', userId);
                formData.append('caption', caption);

                $.ajax({
                    url: '/api/DefaultApi/CreateReel',
                    type: 'POST',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        alert('Reel posted successfully!');
                        $('#postReelPopup').fadeOut();
                        $('#reelVideoInput').val('');
                        $('#captionInput').val('');
                        $('#selectedVideoPreview').empty();

                       
                        fetchAndAppendReels();
                    },
                    error: function (error) {
                        alert('Failed to post reel. Please try again.');
                    }
                });
            });
        });
        $(document).ready(function () {
            fetchAndAppendReels();
        });
            // Function to fetch and append reels
            function fetchAndAppendReels() {
                $.ajax({
                    url: '/api/post/GetAllReels', // Assuming this is your API endpoint to fetch all reels
                    type: 'GET',
                    dataType: 'json',
                    success: function (response) {

                        // Clear existing reels
                        $('#reelsContainer').empty();

                        //// Append fetched reels to the container
                        //if (response && response.length > 0) {
                        //    response.forEach(function (reel) {
                        //        // Assuming each reel has a unique identifier like ID, and contains properties like caption, mediaType, etc.
                        //        var reelHtml =
                        //            '<div class="reel">' +
                        //            '<h3> Caption :' + reel.Caption + '</h3>' +
                                    
                        //            '<video controls src="/' + reel.MediaURL + '" alt="Uploaded Video"></video>'+
                                 
                        //            '</div>';
                        //        $('#reelsContainer').append(reelHtml);
                        //    });
                        //} else {
                        //    $('#reelsContainer').append('<p>No reels found.</p>');
                        //}

                        $.each(response, function (index, reel) {
                            var likesCount = reel.LikesCount;
                            // Construct HTML for each reel
                            var reelHtml = '<section>' +
                                '<div class="reel__container">' +
                                '<video autoplay muted loop class="reel__background-video">' +
                                '<source src="/' + reel.MediaURL + '" type="video/mp4">' +
                                'Your browser does not support the video tag.' +
                                '</video>' +
                                '<div class="reel__title">' +
                                '<div class="reel__back-button">' +
                                //'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-narrow-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">' +
                                //'<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>' +
                                //'<line x1="5" y1="12" x2="19" y2="12"></line>' +
                                //'<line x1="5" y1="12" x2="9" y2="16"></line>' +
                                //'<line x1="5" y1="12" x2="9" y2="8"></line>' +
                                //'</svg>' +
                                '<p>Reels</p>' +
                                '</div>' +
                                //'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-camera" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">' +
                                //'<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>' +
                                //'<path d="M5 7h1a2 2 0 0 0 2 -2a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1a2 2 0 0 0 2 2h1a2 2 0 0 1 2 2v9a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2"></path>' +
                                //'<circle cx="12" cy="13" r="3"></circle>' +
                                //'</svg>' +
                                '</div>' +
                                '<div class="reel__content">' +
                                '<div class="reel__desc">' +
                                '<div class="reel__user">' +
                                '<img src="/' + reel.ProfilePictureURL + '" class="reel__avatar"/>' +
                                '<p class="reel__username">' + reel.Username + '</p>' +
                                /*'<button>Follow</button>' +*/
                                '</div>' +
                                '<p class="reel__caption">Caption : &nbsp;' + reel.Caption + '</p>' +
                                //'<p class="reel__audio">' +
                                //'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tallymark-3" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">' +
                                //'<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>' +
                                //'<line x1="8" y1="7" x2="8" y2="17"></line>' +
                                //'<line x1="12" y1="5" x2="12" y2="19"></line>' +
                                //'<line x1="16" y1="7" x2="16" y2="17"></line>' +
                                //'</svg>' +
                                //'AJR • The Good Part' +
                                //'</p>' +
                                '</div>' +
                                '<div class="reel__options">' +
                                '<svg xmlns="http://www.w3.org/2000/svg" class="like-reel icon icon-tabler icon-tabler-heart" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" data-reel-id="' + reel.ReelId + '">' +
                                '<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>' +
                                '<path d="M19.5 13.572l-7.5 7.428l-7.5 -7.428m0 0a5 5 0 1 1 7.5 -6.566a5 5 0 1 1 7.5 6.572"></path>' +
                                '</svg>' +
                                
                            /*'<span class="like-count" style="font-style:bold;">' + likesCount + ' Likes' + '</span>' +*/
                                '<p class="reel__likes" style="font-style:bold;" >' + likesCount + ' Likes' + '</p>' +
                                /*'<p class="reel__likes">' + reel.LikesCount + '</p>' +*/
                                //'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-message-circle" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">' +
                                //'<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>' +
                                //'<path d="M3 20l1.3 -3.9a9 8 0 1 1 3.4 2.9l-4.7 1"></path>' +
                                //'</svg>' +
                                //'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-send" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">' +
                                //'<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>' +
                                //'<line x1="10" y1="14" x2="21" y2="3"></line>' +
                                //'<path d="M21 3l-6.5 18a0.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a0.55 .55 0 0 1 0 -1l18 -6.5"></path>' +
                                //'</svg>' +
                                //'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-dots-vertical" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">' +
                                //'<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>' +
                                //'<circle cx="12" cy="12" r="1"></circle>' +
                                //'<circle cx="12" cy="19" r="1"></circle>' +
                                //'<circle cx="12" cy="5" r="1"></circle>' +
                                //'</svg>' +
                                //'<img src="' + reel.AudioCoverUrl + '" class="reel__audio-cover"/>' +
                                '</div>' +
                                '</div>' +
                                '</div>' +
                                '</section><br>';

                            // Append the constructed HTML block to the container
                            $('#reelsContainer').prepend(reelHtml);
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error('Error fetching reels:', error);
                        $('#reelsContainer').empty().append('<p>Error fetching reels. Please try again later.</p>');
                    }
                });
            }

        $(document).on('click', '.like-reel', function () {
            var $this = $(this);
            var ReelId = $this.data('reel-id');
            var UserId = localStorage.getItem('UserId');
            $.ajax({
                url: '/api/post/LikeReel',
                method: 'POST',
                data: { ReelID: ReelId, UserID: UserId },
                success: function (data) {
                    fetchAndAppendReels();
                    console.log(data.likeCount);
                    // Update the like count value
                    $this.find('.Like-Count').text(data.likeCount);
                    if (data.likeCount > 0) {
                        $this.find('i').removeClass('fa-regular fa-heart').addClass('fa-solid fa-heart');
                    } else {
                        $this.find('i').removeClass('fa-solid fa-heart').addClass('fa-regular fa-heart');
                    }
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });
            


    </script>
</body>
    </html>
